library(foreign)
library(stringr)
library(glmnet)
library(missMDA)
library(MASS)
data=read.csv("/Users/NYao/Documents/Work/Carine/Carine_12_04_2016 final (1).csv")
cbcl=read.csv("/Users/NYao/Dropbox/Code/Interaction/CBCL.csv")
sdq=read.csv("/Users/NYao/Documents/Work/Carine/sdq_24_05_2016.csv", header=TRUE)
data$PSCID=str_trim(gsub("-", "_", data$PSCID))
cbcl$PSCID=str_trim(cbcl$PSCID)
idpool=intersect(as.character(data$PSCID), as.character(cbcl$PSCID))
cleandata=data[na.omit(match(idpool, data$PSCID)), ]
cleancbcl=cbcl[na.omit(match( idpool, cbcl$PSCID)), ]
all(cleandata$PSCID==cleancbcl$PSCID)
phenotype=cleancbcl[, c('sc8raw.48m', 'sc9raw.48m','sc8raw.60m', 'sc9raw.60m' )]; colnames(phenotype)=c("internal48", "external48", "internal60", "external60")
giclean=cleandata$GI_clean.12m
giext=cleandata$GI_extrapolated.12m
### first-born original and interval were excluded due to colinearity
confounder=as.data.frame(cleandata[,c(-1, -2,-3,-4, -5:-7, -36,-37, -38:-40, -41:-556, -which(colnames(cleandata)=='CPE_at_12') )])
confounder=as.data.frame(apply(confounder, 2, as.numeric))
phenotype=cleancbcl[, c('sc8raw.48m', 'sc9raw.48m','sc8raw.60m', 'sc9raw.60m', 'sc10raw.48m', 'sc10raw.60m')]; colnames(phenotype)=c("internal48", "external48", "internal60", "external60", "total48", "total60")
colnames(phenotype)
total48=as.numeric(phenotype$total48)
total60=as.numeric(phenotype$total60)
ana1=analysis(internal48, giclean, confounder)
source("/Users/NYao/Documents/Work/Carine/GI_functions.R")
ana1=analysis(internal48, giclean, confounder)
internal48=as.numeric(phenotype$internal48)
external48=as.numeric(phenotype$external48)
internal60=as.numeric(phenotype$internal60)
external60=as.numeric(phenotype$external60)
total48=as.numeric(phenotype$total48)
total60=as.numeric(phenotype$total60)
ana1=analysis(internal48, giclean, confounder)
ana9=analysis(total48, giclean, confounder)
ana10=analysis(total48, giext, confounder)
ana11=analysis(total60, giclean, confounder)
ana12=analysis(total60, giext, confounder)
ana9$Coef
ana10$Coef
ana11$Coef
ana12$Coef
ana9$cleanLM
summary(ana9$cleanLM)
summary(ana10$cleanLM)
summary(ana11$cleanLM)
summary(ana12$cleanLM)
summary(ana12$backLM)
summary(ana9$backLM)
summary(ana9$backLM)
summary(ana10$backLM)
summary(ana11$backLM)
summary(ana12$backLM)
library(foreign)
library(stringr)
library(glmnet)
library(missMDA)
library(MASS)
data=read.csv("/Users/NYao/Documents/Work/Carine/Carine_12_04_2016 final (1).csv")
cbcl=read.csv("/Users/NYao/Dropbox/Code/Interaction/CBCL.csv")
sdq=read.csv("/Users/NYao/Documents/Work/Carine/sdq_24_05_2016.csv", header=TRUE)
data$PSCID=str_trim(gsub("-", "_", data$PSCID))
cbcl$PSCID=str_trim(cbcl$PSCID)
idpool=intersect(as.character(data$PSCID), as.character(cbcl$PSCID))
cleandata=data[na.omit(match(idpool, data$PSCID)), ]
cleancbcl=cbcl[na.omit(match( idpool, cbcl$PSCID)), ]
all(cleandata$PSCID==cleancbcl$PSCID)
phenotype=cleancbcl[, c('sc8raw.48m', 'sc9raw.48m','sc8raw.60m', 'sc9raw.60m', 'sc10raw.48m', 'sc10raw.60m')]; colnames(phenotype)=c("internal48", "external48", "internal60", "external60", "total48", "total60")
giclean=cleandata$GI_clean.12m
giext=cleandata$GI_extrapolated.12m
### first-born original and interval were excluded due to colinearity
confounder=as.data.frame(cleandata[,c(-1, -2,-3,-4, -5:-7, -36,-37, -38:-40, -41:-556, -which(colnames(cleandata)=='CPE_at_12') )])
confounder=as.data.frame(apply(confounder, 2, as.numeric))
#confounder[, c(3,7)]=apply(confounder[, c(3,7)], 2, as.factor)
### GI Clean
internal48=as.numeric(phenotype$internal48)
external48=as.numeric(phenotype$external48)
internal60=as.numeric(phenotype$internal60)
external60=as.numeric(phenotype$external60)
total48=as.numeric(phenotype$total48)
total60=as.numeric(phenotype$total60)
source("/Users/NYao/Documents/Work/Carine/GI_functions.R")
ana1=analysis(internal48, giclean, confounder)
ana2=analysis(internal48, giext, confounder)
ana3=analysis(internal60, giclean, confounder)
ana4=analysis(internal60, giext, confounder)
ana5=analysis(external48, giclean, confounder)
ana6=analysis(external48, giext, confounder)
ana7=analysis(external60, giclean, confounder)
ana8=analysis(external60, giext, confounder)
ana9=analysis(total48, giclean, confounder)
ana10=analysis(total48, giext, confounder)
ana11=analysis(total60, giclean, confounder)
ana12=analysis(total60, giext, confounder)
ana6$Coef
ana5=analysis(external48, giclean, confounder)
ana6=analysis(external48, giext, confounder)
ana7=analysis(external60, giclean, confounder)
ana8=analysis(external60, giext, confounder)
ana5$Coef
ana5$Coef
ana5=analysis(external48, giclean, confounder)
ana6=analysis(external48, giext, confounder)
ana7=analysis(external60, giclean, confounder)
ana8=analysis(external60, giext, confounder)
ana5$Coef
ana6$Coef
ana7$Coef
ana8$Coef
ana5$cleanLM
summary(ana5$cleanLM)
ana6$cleanLM
summary(ana6$cleanLM)
summary(ana7$cleanLM)
summary(ana8$cleanLM)
summary(ana5$backLM)
summary(ana6$backLM)
summary(ana7$backLM)
summary(ana8$backLM)
plot(ana5$backLM, which =2)
plot(ana6$backLM, which =2)
plot(ana7$backLM, which =2)
summary(ana9$backLM)
summary(ana5$cleanLM)
plot(ana5$cleanLM, which =2)
plot(ana5$cleanLM, which =2)
plot(ana5$backLM, which =2)
plot(ana5$cleanLM, which =2)
plot(ana6$cleanLM, which =2)
plot(ana7$cleanLM, which =2)
plot(ana8$cleanLM, which =2)
plot(ana8$cleanLM, which =2)
plot(ana5$cleanLM)
summary(ana5$cleanLM)
summary(ana9$cleanLM)
summary(ana10$cleanLM)
summary(ana10$cleanLM)
summary(ana11$cleanLM)
summary(ana11$cleanLM)
summary(ana12$cleanLM)
ana9=analysis(total48, giclean, confounder)
ana10=analysis(total48, giext, confounder)
ana11=analysis(total60, giclean, confounder)
ana12=analysis(total60, giext, confounder)
ana9=analysis(total48, giclean, confounder)
ana10=analysis(total48, giext, confounder)
ana11=analysis(total60, giclean, confounder)
ana12=analysis(total60, giext, confounder)
summary(ana12$cleanLM)
summary(ana1$cleanLM)
summary(ana11$cleanLM)
plot(ana8$cleanLM, which =2)
plot(ana9$cleanLM, which =2)
plot(ana10$cleanLM, which =2)
plot(ana11$cleanLM, which =2)
ana12=analysis(total60, giext, confounder)
plot(ana12$cleanLM, which =2)
plot(ana19$cleanLM, which =2)
plot(ana9$cleanLM, which =2)
plot(ana12$cleanLM, which =2)
plot(ana9$cleanLM which=2)
plot(ana9$cleanLM, which=2)
plot(ana9$backLM, which =2)
plot(ana9$backLM, which =2)
summary(ana9$backLM)
summary(ana10$backLM)
plot(ana10$backLM, which =2)
plot(ana11$backLM, which =2)
ana11=analysis(total60[-248, ], giclean[-248, ], confounder[-248, ])
ana12=analysis(total60[-248, ], giext[-248, ], confounder[-248, ])
ana11=analysis(total60[-248 ], giclean[-248], confounder[-248, ])
ana12=analysis(total60[-248], giext[-248], confounder[-248, ])
plot(ana11$backLM, which =2)
ana12=analysis(total60[-248], giext[-248], confounder[-248, ])
plot(ana12$backLM, which =2)
summary(ana11$backLM)
summary(ana12$backLM)
giclean
confounder
View(confounder)
View(cleandata)
cleandata[which(cleandata$birth_weight_grams==3550), 'PSCID']
cleandata[which(cleandata$birth_weight_grams==3550 & cleandata$age_mother_at_birth==38.91855), 'PSCID']
which(cleandata$birth_weight_grams==3550 & cleandata$age_mother_at_birth==38.91855)
cleandata[which((cleandata$birth_weight_grams==3550)&(cleandata$age_mother_at_birth=="38.91855")), 'PSCID']
cleandata[which((cleandata$birth_weight_grams==3550)&(cleandata$gender=="1")), 'PSCID']
summary(ana11$cleanLM)
summary(ana12$cleanLM)
summary(ana12$cleanLM)
plot(ana11$cleanLM, which =2)
plot(ana12$cleanLM, which =2)
summary(ana12$cleanLM)
summary(ana11$cleanLM)
plot(ana10$cleanLM, which =2)
summary(ana10$cleanLM)
library(foreign)
library(stringr)
library(glmnet)
library(missMDA)
library(MASS)
source("/Users/NYao/Documents/Work/Carine/GI_functions.R")
data=read.csv("/Users/NYao/Documents/Work/Carine/Carine_12_04_2016 final (1).csv")
cbcl=read.csv("/Users/NYao/Dropbox/Code/Interaction/CBCL.csv")
sdq=read.csv("/Users/NYao/Documents/Work/Carine/SDQ 24.05.2016.csv", header=TRUE)
data$PSCID=str_trim(gsub("-", "_", data$PSCID))
cbcl$PSCID=str_trim(cbcl$PSCID)
sdq$PSCID=str_trim(gsub("-", "_", sdq$PSCID))
idpool=intersect(as.character(data$PSCID), as.character(cbcl$PSCID))
cleandata=data[na.omit(match(idpool, data$PSCID)), ]
cleancbcl=cbcl[na.omit(match( idpool, cbcl$PSCID)), ]
all(cleandata$PSCID==cleancbcl$PSCID)
phenotype=cleancbcl[, c('sc8raw.48m', 'sc9raw.48m','sc8raw.60m', 'sc9raw.60m', 'sc10raw.48m', 'sc10raw.60m')]; colnames(phenotype)=c("internal48", "external48", "internal60", "external60", "total48", "total60")
giclean=cleandata$GI_clean.12m
giext=cleandata$GI_extrapolated.12m
colnames(confounder)
colnames(cleandata)
confounder=as.data.frame(cleandata[,c(-1, -2,-3,-4, -5:-7,-10,-11, -31, -32, -36,-37, -38:-40, -41:-556, -which(colnames(cleandata)=='CPE_at_12') )])
confounder=as.data.frame(apply(confounder, 2, as.numeric))
internal48=as.numeric(phenotype$internal48)
external48=as.numeric(phenotype$external48)
internal60=as.numeric(phenotype$internal60)
external60=as.numeric(phenotype$external60)
total48=as.numeric(phenotype$total48)
total60=as.numeric(phenotype$total60)
ana1=analysis(internal48, giclean, confounder)
ana2=analysis(internal48, giext, confounder)
ana3=analysis(internal60, giclean, confounder)
ana4=analysis(internal60, giext, confounder)
ana5=analysis(external48, giclean, confounder)
ana6=analysis(external48, giext, confounder)
ana7=analysis(external60, giclean, confounder)
ana8=analysis(external60, giext, confounder)
ana9=analysis(total48, giclean, confounder)
ana10=analysis(total48, giext, confounder)
ana11=analysis(total60[-248 ], giclean[-248], confounder[-248, ])
ana12=analysis(total60[-248], giext[-248], confounder[-248, ])
internal48
idpool=intersect(as.character(data$PSCID), as.character(cbcl$PSCID))
cleandata=data[na.omit(match(idpool, data$PSCID)), ]
cleancbcl=cbcl[na.omit(match( idpool, cbcl$PSCID)), ]
all(cleandata$PSCID==cleancbcl$PSCID)
phenotype=cleancbcl[, c('sc8raw.48m', 'sc9raw.48m','sc8raw.60m', 'sc9raw.60m', 'sc10raw.48m', 'sc10raw.60m')]; colnames(phenotype)=c("internal48", "external48", "internal60", "external60", "total48", "total60")
giclean=cleandata$GI_clean.12m
giext=cleandata$GI_extrapolated.12m
### first-born original and interval were excluded due to colinearity
confounder=as.data.frame(cleandata[,c(-1, -2,-3,-4, -5:-7,-10,-11, -31, -32, -36,-37, -38:-40, -41:-556, -which(colnames(cleandata)=='CPE_at_12') )])
confounder=as.data.frame(apply(confounder, 2, as.numeric))
#confounder[, c(3,7)]=apply(confounder[, c(3,7)], 2, as.factor)
internal48=as.numeric(phenotype$internal48)
external48=as.numeric(phenotype$external48)
internal60=as.numeric(phenotype$internal60)
external60=as.numeric(phenotype$external60)
total48=as.numeric(phenotype$total48)
total60=as.numeric(phenotype$total60)
ana1=analysis(internal48, giclean, confounder)
internal48
source("/Users/NYao/Documents/Work/Carine/GI_functions.R")
library(stringr)
library(glmnet)
library(missMDA)
library(MASS)
source("/Users/NYao/Documents/Work/Carine/GI_functions.R")
data=read.csv("/Users/NYao/Documents/Work/Carine/Carine_12_04_2016 final (1).csv")
cbcl=read.csv("/Users/NYao/Dropbox/Code/Interaction/CBCL.csv")
sdq=read.csv("/Users/NYao/Documents/Work/Carine/SDQ 24.05.2016.csv", header=TRUE)
data$PSCID=str_trim(gsub("-", "_", data$PSCID))
cbcl$PSCID=str_trim(cbcl$PSCID)
sdq$PSCID=str_trim(gsub("-", "_", sdq$PSCID))
idpool=intersect(as.character(data$PSCID), as.character(cbcl$PSCID))
cleandata=data[na.omit(match(idpool, data$PSCID)), ]
cleancbcl=cbcl[na.omit(match( idpool, cbcl$PSCID)), ]
all(cleandata$PSCID==cleancbcl$PSCID)
phenotype=cleancbcl[, c('sc8raw.48m', 'sc9raw.48m','sc8raw.60m', 'sc9raw.60m', 'sc10raw.48m', 'sc10raw.60m')]; colnames(phenotype)=c("internal48", "external48", "internal60", "external60", "total48", "total60")
giclean=cleandata$GI_clean.12m
giext=cleandata$GI_extrapolated.12m
### first-born original and interval were excluded due to colinearity
confounder=as.data.frame(cleandata[,c(-1, -2,-3,-4, -5:-7,-10,-11, -31, -32, -36,-37, -38:-40, -41:-556, -which(colnames(cleandata)=='CPE_at_12') )])
confounder=as.data.frame(apply(confounder, 2, as.numeric))
#confounder[, c(3,7)]=apply(confounder[, c(3,7)], 2, as.factor)
idpool=intersect(as.character(data$PSCID), as.character(cbcl$PSCID))
cleandata=data[na.omit(match(idpool, data$PSCID)), ]
cleancbcl=cbcl[na.omit(match( idpool, cbcl$PSCID)), ]
all(cleandata$PSCID==cleancbcl$PSCID)
phenotype=cleancbcl[, c('sc8raw.48m', 'sc9raw.48m','sc8raw.60m', 'sc9raw.60m', 'sc10raw.48m', 'sc10raw.60m')]; colnames(phenotype)=c("internal48", "external48", "internal60", "external60", "total48", "total60")
phenotype
source("/Users/NYao/Documents/Work/Carine/GI_functions.R")
data=read.csv("/Users/NYao/Documents/Work/Carine/Carine_12_04_2016 final (1).csv")
cbcl=read.csv("/Users/NYao/Dropbox/Code/Interaction/CBCL.csv")
sdq=read.csv("/Users/NYao/Documents/Work/Carine/SDQ 24.05.2016.csv", header=TRUE)
data$PSCID=str_trim(gsub("-", "_", data$PSCID))
cbcl$PSCID=str_trim(cbcl$PSCID)
sdq$PSCID=str_trim(gsub("-", "_", sdq$PSCID))
idpool=intersect(as.character(data$PSCID), as.character(cbcl$PSCID))
cleandata=data[na.omit(match(idpool, data$PSCID)), ]
cleancbcl=cbcl[na.omit(match( idpool, cbcl$PSCID)), ]
all(cleandata$PSCID==cleancbcl$PSCID)
phenotype=cleancbcl[, c('sc8raw.48m', 'sc9raw.48m','sc8raw.60m', 'sc9raw.60m', 'sc10raw.48m', 'sc10raw.60m')]; colnames(phenotype)=c("internal48", "external48", "internal60", "external60", "total48", "total60")
giclean=cleandata$GI_clean.12m
giext=cleandata$GI_extrapolated.12m
### first-born original and interval were excluded due to colinearity
confounder=as.data.frame(cleandata[,c(-1, -2,-3,-4, -5:-7,-10,-11, -31, -32, -36,-37, -38:-40, -41:-556, -which(colnames(cleandata)=='CPE_at_12') )])
confounder=as.data.frame(apply(confounder, 2, as.numeric))
#confounder[, c(3,7)]=apply(confounder[, c(3,7)], 2, as.factor)
source("/Users/NYao/Documents/Work/Carine/GI_functions.R")
data=read.csv("/Users/NYao/Documents/Work/Carine/Carine_12_04_2016 final (1).csv")
cbcl=read.csv("/Users/NYao/Dropbox/Code/Interaction/CBCL.csv")
sdq=read.csv("/Users/NYao/Documents/Work/Carine/SDQ 24.05.2016.csv", header=TRUE)
data$PSCID=str_trim(gsub("-", "_", data$PSCID))
cbcl$PSCID=str_trim(cbcl$PSCID)
sdq$PSCID=str_trim(gsub("-", "_", sdq$PSCID))
idpool=intersect(as.character(data$PSCID), as.character(cbcl$PSCID))
cleandata=data[na.omit(match(idpool, data$PSCID)), ]
cleancbcl=cbcl[na.omit(match( idpool, cbcl$PSCID)), ]
all(cleandata$PSCID==cleancbcl$PSCID)
phenotype=cleancbcl[, c('sc8raw.48m', 'sc9raw.48m','sc8raw.60m', 'sc9raw.60m', 'sc10raw.48m', 'sc10raw.60m')]; colnames(phenotype)=c("internal48", "external48", "internal60", "external60", "total48", "total60")
giclean=cleandata$GI_clean.12m
giext=cleandata$GI_extrapolated.12m
### first-born original and interval were excluded due to colinearity
confounder=as.data.frame(cleandata[,c(-1, -2,-3,-4, -5:-7,-10,-11, -31, -32, -36,-37, -38:-40, -41:-556, -which(colnames(cleandata)=='CPE_at_12') )])
confounder=as.data.frame(apply(confounder, 2, as.numeric))
#confounder[, c(3,7)]=apply(confounder[, c(3,7)], 2, as.factor)
### GI Clean
internal48=as.numeric(phenotype$internal48)
external48=as.numeric(phenotype$external48)
internal60=as.numeric(phenotype$internal60)
external60=as.numeric(phenotype$external60)
total48=as.numeric(phenotype$total48)
total60=as.numeric(phenotype$total60)
clean48
internal48
mtcars
summary(lm(mpg))
summary(lm(mpg~cyl+hp, data=mtcars))
summary(lm(mpg~cyl+wt, data=mtcars))
summary(lm(mpg~cyl/3+wt, data=mtcars))
summary(lm(mpg~(mtcars$cyl)/3+wt, data=mtcars))
cyl3=mtycars$cyl/3
cyl3=mtcars$cyl/3
summary(lm(mpg~mtcars$cyl3+wt, data=mtcars))
summary(lm(mtcars$mpg~mtcars$cyl3+mtcars$wt))
summary(lm(mtcars$mpg~cyl3+mtcars$wt))
summary(lm(mpg~mtcars$cyl3+wt, data=mtcars))
summary(lm(mpg~cyl+wt, data=mtcars))
cylmean=mean(mtcars$cyl)
cyl=matcars$cyl
cyl=mtcars$cyl
wt=mtcars$wt
mpg=mtcars$mpg
summary(lm(mpg~cyl+mpg))
summary(lm(mpg~cyl+wt))
summary(lm(mpg~cylmean+wt))
cylmeanadj=cyl-cylmean
summary(lm(mpg~cyl+wt))
summary(lm(mpg~cylmeanadj+wt))
center(cyl)
cylcenter=scale(cyl, scale=FALSE)
all(cylcenter==cylmeanadj)
summary(mpg~cyl*wt)
summary(lm(mpg~cyl*wt))
summary(lm(mpg~cylmeanadj*wt))
file=read.table("randNet_topics.txt")
file=read.table("/Users/NYao/Documents/MIDS/261/HW9 /randNet_topics.txt")
table(file[,2])
load("~/Documents/Work/5-bolasso/MAVAN3+4+EPDS.RData")
rm(genofinal)
rm(genoclean)
rm(genodata)
rm(macanC)
rm(mavanC)
rm(mavanCgenotype)
save.image("~/Documents/Work/5-bolasso/Bolasso_prep.RData")
load("~/Documents/Work/GXEvalidation/GUSTO_replication_10_03.RData")
colnames(newstai)
table(newstai$visit_label)
ls -l /Library/Frameworks/R.framework/Versions/
q()
load("~/Documents/MIDS/209/FinalProject/Code/04-03.RData")
table(zikaCoorSA_sample$report_date)
load("~/Documents/MIDS/209/FinalProject/Code/04-14.RData")
unique(zikaClean$Country)
library(readr)
library(dplyr)
library(data.table)
library(ggplot2)
library(RColorBrewer)
library(rworldmap)
library(ggmap)
library(geonames)
library(rjson) # load rjson package
library(data.table)
library(xlsx)
library(data.table)
data(zipcode)
setwd("/Users/NYao/Documents/MIDS/209/FinalProject/Web")
zika = read.csv("SA-main/Zika_all_clean_AL.csv", as.is = T)
zika = data.table(zika)
zika$report_date=as.Date(zika$report_date, format="%Y-%m-%d")
#cumu_state =zika[zika$location_type%in%c("province", "region", "territory", "state"),]
# cumu_state_confirmed = cumu_state[Confirmed_Cumulative=="Yes",]
# table(cumu_state_confirmed$Country)
# cumu_state_clean= cumu_state_confirmed[!is.na(lon),]
# write.csv(cumu_state_clean, "SA-main/Zika_cumulative_confirmed_clean.csv", row.names = F, quote = F)
## Analyze each country closely  (not useful)
cumu_state_clean=data.table(cumu_state_clean)
argen =cumu_state[Country=="Argentina",]
argen_cumu = argen[data_field%in%c("cumulative_confirmed_local_cases", "cumulative_confirmed_imported_cases")]
argen_cumu = argen %>%
filter(data_field%in%c("AR0001", "AR0003")) %>%
group_by(Province, report_date) %>%
summarize(value = sum(as.numeric(value)),
lon=max(lon),
lat=max(lat))
bra = cumu_state[Country=="Brazil",]
bra_cumu
centro = cumu_state[Country=="Centro",]
col = zika[Country=="Colombia",];table(col$location_type)
col = col[col$data_field_code%in%c("CO0001", "CO0002"),]
col_cumu = col %>%
group_by(Province, report_date) %>%
summarize(value = sum(as.numeric(value)),
lon=max(lon),
lat=max(lat))
dom = zika
mexico = zika[Country=="Mexico", ]
mexico_cumu=mexico[]
##### *************************   Cleaning Starts  *******************************************
## select the right data fields from the total data
cumulative_confirmed_code = c("AR0001","BR0011","DO0006", "EC0002", "FR0001",
"GT0008", "HA0002", "MX0002", "MX0003", "NI0003",
"PR0003")
# panama's cumulative needs to be calculated
panama = zika[Country=="Panama",]
panam_ordered = panama[order(report_date),]
panam_final=panam_ordered%>%
filter(location_type=="country")%>%
filter(data_field_code%in%c("PA0003", "PA0004"))%>%
arrange(report_date, location)%>%
group_by(report_date, location)%>%
summarize(value = sum(as.numeric(value)),
lon=max(lon),
lat=max(lat),
Country = unique(Country),
Province =unique(Province))
panam_final$Province=panam_final$Country
panam_final=panam_final%>%
select(report_date, Province, lon, lat, value)
# USVI 's cumulative needs to be calculated
usvi = zika[Country=="United_States_Virgin_Islands",]
usvi_final = usvi%>%filter(location_type == "territory")%>%
arrange(report_date, location)%>%
group_by(report_date, location)%>%
summarize(value = sum(as.numeric(value)),
lon=max(lon),
lat=max(lat),
Country = unique(Country),
Province =unique(Province))%>%
arrange(report_date)%>%
mutate(cummu_cases=cumsum(value))%>%
select(report_date, Province, lon, lat, value)
## USA 's cumulative needs to be calculated
us = zika[Country=="United_States",]
us_final=us%>%filter(location_type%in%c("state", "territory"))%>%
filter(data_field %in%c("zika_reported_local", "zika_reported_travel"))%>%
arrange(report_date, location)%>%
group_by(report_date, location)%>%
summarize(value = sum(as.numeric(value)),
lon=max(lon),
lat=max(lat),
Country = unique(Country),
Province =unique(Province))%>%
select(report_date, Province, lon, lat, value)
#### columbia data needs to be combined at the province level
# columbia_ordered = zika%>%
#   filter(Country=="Colombia", data_field_code%in%c("CO0001", "CO0002"))%>%
#   arrange(location, report_date)
#
colum=zika[Country=="Colombia",]
colum_final=colum%>%filter(data_field_code%in%c("CO0001"))%>%
arrange(report_date, location)%>%
group_by(report_date, location)%>%
summarize(value = sum(as.numeric(value)),
lon=max(lon),
lat=max(lat),
Country = unique(Country),
Province =unique(Province))%>%
group_by(Province,report_date)%>%
summarize(value = sum(as.numeric(value)),
lon=max(lon),
lat=max(lat),
Country = unique(Country))%>%
select(report_date, Province, lon, lat, value)
## all data
confirmed_cumu = zika %>% filter(data_field_code%in%cumulative_confirmed_code)%>%
arrange(report_date, location)%>%
group_by(report_date, location)%>%
summarize(value = sum(as.numeric(value)),
lon=max(lon),
lat=max(lat),
Country = unique(Country),
Province =unique(Province))%>%
select(report_date, Province, lon, lat, value)
final_data = rbind(panam_final, us_final,usvi_final, colum_final, confirmed_cumu)
final_data_clean=final_data[complete.cases(final_data$lon),]
final_data_clean=final_data[complete.cases(final_data$report_date),]
date_id = data.table(report_date=unique(final_data_clean$report_date))
date_id=date_id[order(date_id[,1]),]
date_id$date_id = seq(1,nrow(date_id))
final_data_clean_id = inner_join(final_data_clean, date_id, by="report_date")
nrow(final_data)
nrow(final_data_clean_id)
write.csv(final_data_clean_id,"SA-main/Zika_cumulative_state.csv", row.names = F,quote = F)
unique(final_data_clean_id$report_date)
